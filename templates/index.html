<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Bridge - Trova i tuoi rappresentanti</title>
    {% for css_file in css_files %}
    <link rel="stylesheet" href="{{ url_for('static', filename=css_file) }}">
    {% endfor %}
</head>
<body>
    <div class="header">
        <h1>ðŸ‡®ðŸ‡¹ Civic Bridge</h1>
        <p>Trova i tuoi rappresentanti eletti per Comune</p>
    </div>
    
    <div class="search-box">
        <div class="autocomplete-container">
            <label for="searchInput" class="sr-only">Cerca il tuo comune</label>
            <input type="text" id="searchInput" 
                   placeholder="Inizia a scrivere il nome del comune (es. Roma, Milano...)"
                   aria-label="Cerca il tuo comune"
                   aria-describedby="searchHelp"
                   role="combobox"
                   aria-expanded="false"
                   aria-autocomplete="list">
            <div id="autocompleteList" class="autocomplete-list" role="listbox" aria-label="Suggerimenti comuni"></div>
        </div>
        <div id="searchHelp" class="sr-only">Digita il nome del tuo comune per trovare i tuoi rappresentanti eletti</div>
        <button id="searchButton" aria-describedby="searchHelp">Cerca i miei rappresentanti</button>
    </div>
    
    <div id="results" class="results is-hidden">
        <div id="resultsContent"></div>
    </div>
    
    <!-- Message Composer Modal -->
    <div id="composerModal" class="composer-modal">
        <div class="composer-content">
            <div class="composer-header">
                <h2 id="composerTitle" class="composer-title">Scrivi a [Nome Cognome]</h2>
                <p id="composerSubtitle" class="composer-subtitle">Collegio: [label] Â· Partito: [sigla]</p>
            </div>
            
            <div class="composer-body">
                <!-- Theme Selection -->
                <div class="composer-field">
                    <label class="composer-label required" for="themeSelect">Tema</label>
                    <select id="themeSelect" class="composer-select" required>
                        <option value="">Seleziona un tema...</option>
                    </select>
                </div>
                
                <!-- Subject -->
                <div class="composer-field">
                    <label class="composer-label required" for="subjectInput">Oggetto</label>
                    <input type="text" id="subjectInput" class="composer-input" required>
                </div>
                
                <!-- Message Body -->
                <div class="composer-field">
                    <label class="composer-label" for="bodyTextarea">Testo del messaggio</label>
                    <textarea id="bodyTextarea" class="composer-textarea" readonly></textarea>
                </div>
                
                <!-- Personal Line (Required) -->
                <div class="composer-field">
                    <label class="composer-label required" for="personalLine">Riga personale (obbligatoria)</label>
                    <textarea id="personalLine" class="composer-textarea composer-personal" 
                            placeholder="Aggiungi qui le tue considerazioni personali (minimo 20 caratteri)..." 
                            required minlength="20"></textarea>
                    <div id="personalCounter" class="char-counter">0 / 300 caratteri</div>
                </div>
                
                <!-- Send Method -->
                <div class="composer-field send-method">
                    <label class="composer-label">Metodo di invio</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="sendMailto" name="sendMethod" value="mailto" checked>
                            <label for="sendMailto">Apri nel mio client email</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sendOAuth" name="sendMethod" value="oauth">
                            <label for="sendOAuth">Invia come me (Gmail/Outlook)</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="composer-footer">
                <div class="footer-note">Non salviamo il testo della tua email.</div>
                <div class="footer-buttons">
                    <button type="button" class="btn-secondary" id="closeComposerBtn">Annulla</button>
                    <button type="button" id="sendButton" class="btn-primary" disabled>
                        Invia
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Composer Drawer -->
    <div id="composerDrawer" class="composer-drawer is-hidden">
        <div class="drawer-content">
            <div class="drawer-header">
                <h3>Componi messaggio</h3>
                <button class="drawer-close" id="closeDrawer">Ã—</button>
            </div>
            
            <div class="drawer-body">
                <!-- Recipients -->
                <div class="drawer-section">
                    <label class="drawer-label">Destinatari:</label>
                    <div id="recipientChips" class="recipient-chips"></div>
                </div>
                
                <!-- Template -->
                <div class="drawer-section">
                    <label class="drawer-label" for="templateSelect">Modello:</label>
                    <select id="templateSelect" class="drawer-select">
                        <option value="">Seleziona un modello...</option>
                        <option value="segnalazione">Segnalazione problema locale</option>
                        <option value="richiesta_info">Richiesta informazioni</option>
                        <option value="proposta_civica">Proposta civica</option>
                    </select>
                </div>
                
                <!-- Subject -->
                <div class="drawer-section">
                    <label class="drawer-label" for="drawerSubject">Oggetto:</label>
                    <input type="text" id="drawerSubject" class="drawer-input" placeholder="Oggetto del messaggio">
                </div>
                
                <!-- Body -->
                <div class="drawer-section">
                    <label class="drawer-label" for="drawerBody">Messaggio:</label>
                    <textarea id="drawerBody" class="drawer-textarea" rows="6" placeholder="Scrivi il tuo messaggio..."></textarea>
                </div>
            </div>
            
            <div class="drawer-footer">
                <div class="footer-hint">I destinatari senza email verranno esclusi automaticamente.</div>
                <div class="footer-actions">
                    <button id="copyTextBtn" class="btn-secondary">Copia testo</button>
                    <button id="openEmailBtn" class="btn-primary">Apri email</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Assets -->
    {% if is_debug %}
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% else %}
    {% for js_file in js_files %}
    <script src="{{ url_for('static', filename=js_file) }}"></script>
    {% endfor %}
    {% endif %}
</body>
</html>