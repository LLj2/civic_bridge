<!DOCTYPE html>
<html>
<head>
    <title>Autocomplete Test</title>
    <style>
        .autocomplete-container { position: relative; width: 400px; margin: 50px auto; }
        input { width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; }
        .autocomplete-list {
            position: absolute; top: 100%; left: 0; right: 0; background: white;
            border: 1px solid #ddd; max-height: 200px; overflow-y: auto; display: none;
        }
        .autocomplete-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .autocomplete-item:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Autocomplete Test</h1>
    <div class="autocomplete-container">
        <input type="text" id="searchInput" placeholder="Type 'roma' to test autocomplete">
        <div id="autocompleteList" class="autocomplete-list"></div>
    </div>
    
    <script>
        let autocompleteTimeout;
        
        function setupAutocomplete() {
            const input = document.getElementById('searchInput');
            const list = document.getElementById('autocompleteList');
            
            input.addEventListener('input', function() {
                const query = this.value.trim();
                clearTimeout(autocompleteTimeout);
                
                if (query.length < 2) {
                    hideAutocomplete();
                    return;
                }
                
                autocompleteTimeout = setTimeout(() => {
                    fetchAutocomplete(query);
                }, 300);
            });
            
            input.addEventListener('blur', function() {
                setTimeout(() => hideAutocomplete(), 200);
            });
        }
        
        function fetchAutocomplete(query) {
            fetch(`http://localhost:5000/api/autocomplete?q=${encodeURIComponent(query)}&limit=8`)
                .then(response => response.json())
                .then(data => {
                    console.log('Autocomplete response:', data);
                    if (data.success && data.results.length > 0) {
                        showAutocompleteResults(data.results);
                    } else {
                        hideAutocomplete();
                    }
                })
                .catch(error => {
                    console.error('Autocomplete error:', error);
                    hideAutocomplete();
                });
        }
        
        function showAutocompleteResults(results) {
            const list = document.getElementById('autocompleteList');
            list.innerHTML = '';
            
            results.forEach(result => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                item.textContent = result.display;
                item.addEventListener('click', () => {
                    document.getElementById('searchInput').value = result.comune;
                    hideAutocomplete();
                });
                list.appendChild(item);
            });
            
            list.style.display = 'block';
        }
        
        function hideAutocomplete() {
            document.getElementById('autocompleteList').style.display = 'none';
        }
        
        // Initialize
        setupAutocomplete();
    </script>
</body>
</html>